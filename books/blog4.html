<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>《战斗系统分析》 | CopeJay个人博客</title>
    <meta name="description" content="Game Developer">
    <link rel="stylesheet" href="/assets/style.c3210e46.css">
    <link rel="modulepreload" href="/assets/app.b0f20e76.js">
    <link rel="modulepreload" href="/assets/books_blog4.md.fbcdcbd5.lean.js">
    
    <script async="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <meta name="twitter:title" content="《战斗系统分析》 | CopeJay个人博客">
  <meta property="og:title" content="《战斗系统分析》 | CopeJay个人博客">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-675d8756><div class="sidebar-button" data-v-675d8756><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="CopeJay个人博客, back to home" data-v-675d8756 data-v-cc01ef16><!----> CopeJay个人博客</a><div class="flex-grow" data-v-675d8756></div><div class="nav" data-v-675d8756><nav class="nav-links" data-v-675d8756 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/" data-v-b8818f8c>主页 <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/project/index" data-v-b8818f8c>项目总览 <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item active" href="/books/index" data-v-b8818f8c>博客文章 <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/about/index" data-v-b8818f8c>关于作者 <!----></a></div></div><!--]--><!----><!----></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-83e92a68><nav class="nav-links nav" data-v-83e92a68 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/" data-v-b8818f8c>主页 <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/project/index" data-v-b8818f8c>项目总览 <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item active" href="/books/index" data-v-b8818f8c>博客文章 <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/about/index" data-v-b8818f8c>关于作者 <!----></a></div></div><!--]--><!----><!----></nav><!--[--><!--]--><ul class="sidebar-links" data-v-83e92a68><!--[--><li class="sidebar-link"><p class="sidebar-link-item">网站导航</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/">主页</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/project/index">项目总览</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/books/index">博客文章</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/about/index">关于作者</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><h2 id="《战斗系统分析》" tabindex="-1">《战斗系统分析》 <a class="header-anchor" href="#《战斗系统分析》" aria-hidden="true">#</a></h2><p>总览主界面的战斗流程。</p><p>战斗系统功能：输入战斗信息，输出战斗演示过程。</p><p>功能流程分解： 1.接收战斗信息输入--处理战斗信息--创建战斗地图--创建战斗人物-- 初始化人物信息与位置 2.获得所有人物的引用权限--监控战斗全流程--通知角色行动</p><p>实际运行流程：系统通知一个角色行动---角色攻击--查找目标--调用目标受击函数传入攻击数据--接收到攻击做出反应--角色行动完毕--报告系统--系统调用下一个角色行动</p><p>先来一个模块，给我把地图和人物都创建好，把人物的引用给我提交出来就行了</p><p>然后再来一个模块，输入地图和人物数据，统计下一回合该轮到谁来行动。</p><p>再来一个模块，输入攻击模式，输出应该攻击的目标列表</p><p>然后来一个总控，调用第一个模块，把人物都处理好，然后调用第二个模块，调用第一个人物开始行动，把第三个模块传入人物，让它开始它自己的攻击。</p><p>这里的流程充分反映出了一个系统内部的复杂性，因为人物本来是属于初始化模块下的，有它进行了创建，但是到后面，这一部分数据却要被传入攻击搜索模块，然后创建出来的实例又要使用攻击搜索模块，这种调用关系乱成一团。</p><p>首先是数据，第一个模块接收数据传入，却又要把创建好的引用列表又传入第三个模块，模块之间要做到完全独立这不太现实。所以，我们需要对模块的使用历程进行一个划分。 有的模块在系统的运作流程之中，只被使用一次，就像战斗初始化模块，只在第一次初始化的时候才会运行一遍，产生出人物引用列表之后就不再调用。 那个目标搜索模块却要被重复使用，行动回合统计模块也是重复使用的，但是他们的使用层级又不一样，目标搜索是给角色使用，行动回合统计却是被系统自己使用。</p><p>一个模块是什么？是一个类，类与类之间为什么有不同，因为他们的三方库引用不同，他们内部的数据不同，他们的方法逻辑不同。一个搜索模块，它只接收所有玩家的位置和引用，然后根据输入的攻击模式不同，就能自动输出应该攻击的对象引用。 一个初始化模块，制作地图那个是不变的，但是制作角色的那个却会变，它需要利用不同的角色阵容，分配不同的位置，还要调用每个角色的初始化方法，赋予不同的人物数据。 我想通过初始化和实际运作的两条线去梳理系统之间的复杂关系。 初始化是一个怎样的流程，什么模块接收最开始的数据，什么产生什么数据，这个数据又被传入什么模块，当所有的模块都被初始化完成了，一个系统的初始化就完成了。 完成初始化之后开始运行了。 一个类在哪里被创建，它的引用就会从这里被开始发现，现在都使用类来构建代码，就像预制体的类，它的实例在初始化文件被创建，那么就只有在这里才能找到它的引用。 把这个引用列表存下来，他就变成了这个文件的属性之一，这个文件也是一个类。 这个时候，这些类还是这个文件的下属，因为你要访问角色就必须通过这个类，一开始确实是这样的，初始化的时候是这样的。 然后这个引用就被传出去了，它就被搜索模块给接收了，接收了就被管理了，这种层级所属关系就变化了，然后这种关系又变化了，搜索模块又被角色类给调用了，乱套了。 所以在这里我得出一个规律，在初始化的时候，各种层级还算简单，但是一旦这个类的实例被创建出来，这个类就变得自由了。 一个类是有他自己的私有属性的，也有公有属性，私有属性外部访问不了，公有属性却可以被访问。属性是什么？属性就代表了存储空间，多个属性就代表了多个存储空间，有的存的是实际的数据，有的存的是引用。 方法呢，方法就是一串行为逻辑，方法就是要对一些数据进行一些处理，他也可以进行返回，自由程度很大，就分为了有参无参，有无返回值。 一个类是什么？就是用来管理这些参数和方法的一个对象， 一个类在被创建之前只是模板，不具有实在的存储空间，是预备役还没有正式上任。 一个类是不能太大的，太大了人类就无法很好的管理他。 于是，我们想出了让类之间相互合作的办法，在一个类里面引用其它类，就能让它获得其它类的能力，存储某些数据，做出某些反应。 我在制作一个战斗系统的时候，是不是也是在创建一个巨大的类呢，好像确实是。 这个类只需要输入战斗双方的数据，然后它就能借助update，一直运行。 创建战斗地图，战斗角色，不断进行战斗模拟。 这个类让我感觉到不舒服，虽然它可以正常运行，但是这其中的关系让我感觉到非常混乱，如果我需要对它进行改动的话，就需要对它进行梳理，这将会是一项非常困难的工作。换句话说，我虽然把它写出来了，但他已经脱离了我的掌控，这在程序开发中将会造成巨大的灾难。 其实在这个系统创建之初，我设想的是另一种模式。 一开始，我想的是创建一个导演，导演下面有一堆小弟，它指挥这些小弟，搭建好台子，把演员安排到位，然后自己自动编排剧本，哪个演员行动到哪里，做出什么行为特效，下一个演员怎么行动。这里安排剧本太死板了，要写出自动安排出好剧本的编导类，这太困难。 后来就改模式，让导演出于服务位置，让演员来进行主导，导演只在一开始拿到剧本，然后让演员进行化妆，每个演员拿到自己的剧本，然后导演喊出开始，编导统计一下该轮到谁来行动，通知演员，演员开始行动，它开始解析自己的剧本，然后告诉编导，我的攻击方式，问他我该攻击谁？拿到所有消息，开始行动，我做出什么行为，移动到哪里，发出攻击行为，这些都是他和另一个演员哪里得到的消息，行动完成，告诉导演，导演喊下一个演员表演。演员会统计自己的状态，什么时候该退场，就通知导演，然后自己退场。</p><p>这里反映出一个问题，类是很复杂的，尤其是多个类组合起来更是复杂，类与类之间到底是如何协作的，协作方式这些都是创造者可以自由创作的空间，看起来其实能够选择的方案很多，但是有的方案只有到一定程度才会发现它的制作非常困难。</p><p>系统不能太复杂，不然开发就无法进行下去了。 就像植物大战僵尸，它的系统架构并不复杂，但这也不影响它是一个成功的项目。 植物大战僵尸的战斗是怎么做的？它的每一个植物，每个僵尸都有自己的逻辑，它根本用不着一个系统去对他们进行管理，而是由他们自己进行自我管理。自己决定死亡，自己决定行动，自己决定攻击。 创造者只做了一件什么事情？创造规则。 原子化，游戏里面的逻辑判断，它都把它放在角色本身，让它自己去进行逻辑判断。 创造者是创造了一个逻辑体，而不是自己去掌握整个逻辑流程。 这个逻辑流程是由逻辑体自己去执行的。</p><p>或许我应该把战斗的掌控权大量地交给角色本身。</p><p>要完成一个系统的方法有很多，但是我应该要选择封装程度最高的那一种。</p><p>为什么设计出一个复杂的角色，使用多个角色会比设计一个复杂的系统更简单呢？ 因为设计角色，所有的重点都围绕角色展开，把基础搭建好之后它会自己行动 而设计系统，却又需要考虑到整个系统的全部流程，每一步都需要独立设计。</p><p>角色这里就是单中心结构，而系统却是一个多中心的结构。 单中心只需要自身逻辑自洽，而多中心却还要考虑各部分的协作和通信关系。</p><p>拥有模块：战斗预处理模块，战斗阵容管理模块</p><p>战斗预处理模块：接收战斗开始所需要的战斗信息 ，拥有战斗地图创建文件，</p></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-07c132fc><div class="edit" data-v-07c132fc><div class="edit-link" data-v-07c132fc data-v-1ed99556><!----></div></div><div class="updated" data-v-07c132fc><!----></div></footer><!----><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"about_about.md\":\"acc5c7b2\",\"about_arch.md\":\"937f9fd0\",\"about_index.md\":\"0aa915d2\",\"books_blog1.md\":\"489e7de2\",\"books_blog2.md\":\"ab892a94\",\"books_blog3.md\":\"bd3f20d2\",\"books_blog4.md\":\"fbcdcbd5\",\"books_index.md\":\"f1a5547f\",\"index.md\":\"40ec6bfc\",\"project_game1.md\":\"a18cffc8\",\"project_game2.md\":\"3f01381c\",\"project_index.md\":\"203867f2\"}")</script>
    <script type="module" async src="/assets/app.b0f20e76.js"></script>
    
  </body>
</html>